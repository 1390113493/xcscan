import{r as e,s,o as a,c as t,w as r,a as u,b as i,d as l,t as d,e as o,f as n,i as m,g as c,h as f}from"./index.181fe990.js";import{_ as g,b as p,g as _,r as h,a as y,c as b,d as k}from"./storage.c59ed215.js";import{_ as w}from"./uni-card.058dd26d.js";import{e as j}from"./encode.0f19f51a.js";import"./md5.5401987c.js";var F="/assets/wc_scan.07a64a59.png";var $=g({data:()=>({username:"",scanData:"",message:"",result:null,wait:!0,error:!1}),methods:{toRecord(s,a){console.log(a);let t=j(this.username,a);e({url:p+"scan",method:"POST",data:{ustring:t,building:s},success:e=>{if(this.message=e.data.msg,0==e.data.code){let s=e.data.data;this.result={time:s.create_time,building:s.building.name}}else this.error=!0,this.$refs.error.open("top")},fail:()=>{this.error=!0,this.message="发生错误，请重试！\n如果多次失败，请联系学工办管理人员！",this.$refs.error.open("top")}})}},onLoad(){this.username=_("username");let e=this.$route.query.building,s=this.$route.query.timestring;e&&this.toRecord(e,s),this.wait=!1},onShow(){this.username=_("username"),this.username||s({url:"/pages/my/my"})}},[["render",function(e,s,g,p,_,j){const $=h(n("uni-popup-message"),k),v=h(n("uni-popup"),y),q=m,x=c,R=h(n("uni-card"),w),S=f,D=h(n("copyright"),b);return _.username?(a(),t(S,{key:0},{default:r((()=>[u(v,{ref:"success",type:"message"},{default:r((()=>[u($,{type:"success",message:_.message,duration:2e3},null,8,["message"])])),_:1},512),u(v,{ref:"error",type:"message"},{default:r((()=>[u($,{type:"error",message:_.message,duration:5e3},null,8,["message"])])),_:1},512),u(S,{class:"scan"},{default:r((()=>[_.wait?(a(),t(S,{key:0,class:"wait"},{default:r((()=>[u(R,{title:"请等待"},{default:r((()=>[u(q,null,{default:r((()=>[i("正在处理扫描结果中，请稍后")])),_:1}),l("br"),u(x,{src:F,mode:"aspectFit"})])),_:1})])),_:1})):(a(),t(S,{key:1},{default:r((()=>[_.result?(a(),t(S,{key:0},{default:r((()=>[u(R,{title:"扫码结果"},{default:r((()=>[u(q,null,{default:r((()=>[i("您在"+d(_.result.building)+"于"+d(_.result.time)+"扫码登记",1)])),_:1}),l("br"),u(x,{src:"/assets/green_ma.bb45699a.png",mode:"aspectFit"})])),_:1})])),_:1})):(a(),t(S,{key:1},{default:r((()=>[1==_.error?(a(),t(S,{key:0},{default:r((()=>[u(R,{title:"请重新扫描二维码"},{default:r((()=>[u(q,null,{default:r((()=>[i(d(_.message),1),l("br"),i("如有问题请联系学工办管理人员！")])),_:1}),l("br"),u(x,{src:F,mode:"aspectFit"})])),_:1})])),_:1})):(a(),t(S,{key:1},{default:r((()=>[u(R,{title:"请使用微信扫一扫"},{default:r((()=>[u(q,null,{default:r((()=>[i("请使用微信扫一扫或浏览器扫码功能。你首先需要绑定身份，之后直接扫码即可")])),_:1}),l("br"),u(x,{src:F,mode:"aspectFit"})])),_:1})])),_:1}))])),_:1}))])),_:1}))])),_:1}),u(D)])),_:1})):o("",!0)}],["__scopeId","data-v-894e318e"]]);export{$ as default};
